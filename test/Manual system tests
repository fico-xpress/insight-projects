# A set of manual system tests in pseudo-gherkin notation

Background: 
    Given the insight version is 5 unless otherwise stated
    And the user is using the provided "Campaign conversion with projects" example
    And the user is on the project management view
        
Feature: create a new project
    Scenario: the new and import buttons are disabled when there is no project name
        Given the "Project Name" field is empty
        Then the "New Project" button is disabled
        Then the "Import Project" buttons is disabled
    
    Scenario: the new and import buttons are enabled when there is a valid project name
        Given the "Project Name" field is empty
        When the user enters a name into the field
        Then the "New Project" button is enabled
        Then the "Import Project" buttons is enabled
    
    Scenario: the new and import buttons are disabled when the existing project name is deleted
        Given the "Project Name" field contains characters
        And the "New Project" button is enabled
        And the "Import Project" buttons is enabled
        When all characters in the "Project Name" field are deleted
        Then the "New Project" button is disabled
        Then the "Import Project" buttons is disabled
    
    Scenario: create a new project
        Given there is not a project with the name "Test 1"
        And there is no other project with the name containing "Test 1"
        When the user enters "Test 1" into the "Project Name" field
        And the user clicks on the "New Project" button
        Then there exists a folder in the app root with the name "Test 1"
        And then the folder "Test 1" is private and owned by the user
        And there exists a scenario of type "PROJECT" with the name "Test 1" in the folder "Test 1"
        And the scenario "Test 1" is private and owned by the user
        And the scenario "Test 1" is queued for LOADing
        And the view changes to the "Data" view
        And the scenario "Test 1" LOAD completes successfully
        And the user is on the project management view
        And the project "Test 1" appears in the list of projects
        
    Scenario: create a new project with the same name as an existing project
        Given there is a project with the name "Test 1"
        And there exists a project with the name "Test 1"
        When the user enters "Test 1" into the "Project Name" field
        And the user clicks on the "New Project" button
        Then there is an error message "Cannot create. A project exists with the same name"
        
    Scenario: user doesnt have the required authority to create a folder
        Given there is not a project with the name "Test 1"
        And the user does not have the FOLDER_NEW authority
        When the user enters "Test 1" into the "Project Name" field
        And the user clicks on the "New Project" button
        Then the dialog closes
        And there is a toast message "Failed to create project"
        And no folder called "Test 1" is created in the app root
    
    Scenario: something goes wrong with creating the project scenario
        Given there is not a project with the name "Test 1"
        And the user does not have SCENARIO_NEW authority
        When the user enters "Test 1" into the "Project Name" field
        And the user clicks on the "New Project" button
        Then the dialog closes
        And there is a toast message "Failed to create project"
        And no folder called "Test 1" is created in the app root <---- FAILED
        
Feature: open a project
    Scenario: open a project successfully
        Given there is a project with the name "Test 1"
        And the project is shown as a row in the project table
        When the user clicks on the row for project "Test 1"
        Then the project scenario for project "Test 1" is set as the contents of the shelf
        And the user is navigated to the (default view) Data view.

Feature: shelf validation
    Scenario: user goes to a view without opening a project
        Given the user is on the home page
        When the user selects a project based app
        And then navigates to a view that isnt the project management view
        Then a message is show "There is no active project. Please create or open a project".
        And a link is shown that takes the user to the project management view
        
    Scenario: user places a scenario that doesnt belong to the project onto the shelf   
        Given the user has opened project "Test 1"
        And there is a project "Test 2"
        And there is a standard scenario in "Test 2"
        When the user selects the "Test 2" scenario for the shelf
        Then there is an info message "There are scenarios from different projects..." displayed to the user

Feature: rename a project
    Scenario: rename a project successfully
         Given there is a project with the name "Test 1"
         And there is not a project with the name "Test 2"
         When the user clicks on the "Rename" option for that project
         Then the "Rename Project" dialog opens
         And the "Project Name" is populated with "Test 1"
         Then the user enters the name "Test 2"
         And clicks the "Rename" button
         Then the dialog closes
         And the project is renamed to "Test 2" in the project list
         And the root folder is renamed to "Test 2"
         And the project scenario in the folder is renamed to "Test 2"
         
    Scenario: name conflict when renaming
         Given there is a project with the name "Test 1"
         And there is a project with the name "Test 2"
         When the user clicks on the "Rename" option for that project
         Then the "Rename Project" dialog opens
         And the "Project Name" is populated with "Test 1"
         Then the user enters the name "Test 2"
         And clicks the "Rename" button
         Then the dialog closes
         And there is a toast error message "Cannot rename. A project exists with the same name"

Feature: clone a project
    Scenario: clone a project successfully
        Given there is a project with the name "Test 2"
        And there is not a project with the name "Test 3"
        When the user clicks on the "Clone" option for the "Test 2" project
        Then the "Clone Project" dialog opens
        And the "Project Name" is populated with "Test 2 - copy"
        When the user enters the name "Test 3"
        And clicks the "Clone" button
        Then the dialog closes
        And a new project "Test 3" is displayed in the project list
        And there exists a folder in the app root with the name "Test 3"
        And then the folder "Test 3" is private and owned by the user
        And there exists a scenario of type "PROJECT" with the name "Test 3" in the folder "Test 3"
        And the scenario "Test 3" is private and owned by the user
        And the scenario "/Test 3/Test 3" is an identical copy of the scenario "/Test 2/Test 2"
        
    Scenario: name conflict with clone
        Given there is a project with the name "Test 2"
        And there is a project with the name "Test 2 - copy"
        When the user clicks on the "Clone" option for the "Test 2" project
        Then the "Clone Project" dialog opens
        And the "Project Name" is populated with "Test 2 - copy"
        When the user clicks the "Clone" button
        Then the dialog closes
        And an error message "Cannot clone. A project exists with the same name" is displayed

Feature: share a project
    Scenario Outline: share a project successfully
        Given there is a project with the name "Test 2"
        And the project is <orig_share>
        When the user clicks on the "Share" option for that project
        Then the "Share Project" dialog opens
        And the <orig_share> option is selected
        When the user clicks on the <new_share> option
        And clicks on the "Share" button
        Then the dialog closes
        And the share status of the project folder is set to <folder>
        And the share status of the project scenario is set to <scenario>
        
        orig_share|new_share|folder|scenario
        "Dont share this project"|"Share project and scenarios read only"|readonly|readonly
        "Share project and scenarios read only"|"Allow other users to create/edit scenarios"|full|readonly
        "Allow other users to create/edit scenarios"|"Allow other users to edit the project and create/edit scenarios"|full|full
        "Allow other users to edit the project and create/edit scenarios"|"Dont share this project"|private|private
        
    Scenario: share action cannot be performed
        Given there is a project with the name "Test 2"
        And the project status is "Dont share this project"
        And the user does not have "SCENARIO_SHARE" authority
        When the user clicks on the "Share" option for that project
        Then the "Share Project" dialog opens
        And the "Dont share this project" option is selected
        When the user clicks on the "Share project and scenarios read only" option
        And clicks on the "Share" button
        Then the dialog closes
        And an error message "Failed to change the project share status" is displayed
        
Feature: delete a project
    Scenario: delete a project successfully
        Given there is a project with the name "Test 3"
        When the user clicks on the "Delete Project" option for that project
        Then the "Delete Project" dialog opens
        When the user clicks on the "Delete" button
        Then the dialog closes
        And the "Test 3" project is not displayed in the project list
        And the "Test 3" folder is deleted from the root
    
    Scenario: fail to delete a project
        Given there is a project with the name "Test 3"
        And the user does not have FOLDER_DELETE authority
        When the user clicks on the "Delete Project" option for that project
        Then the "Delete Project" dialog opens
        When the user clicks on the "Delete" button
        Then the dialog closes
        And the error message "Failed to delete project 'Test 3'. No changes have been made"

Feature: export a project
    Scenario: export a project successfully
        Given there is a project with the name "Test 3"
        When the user clicks on the "Export Project" option for that project
        Then the "Export Project" dialog opens
        When the user clicks on the "Export" button
        Then the dialog closes
        And the "Tasks" dialog opens
        And there is an item in the "Tasks" dialog for the "Test 3" folder export
        And the task completes successfully
        And there is a download link to the exported "Test 3" project
        
    Scenario: fails to export a project
        Given there is a project with the name "Test 3"
        And user A sees project "Test 3" in the projects list
        When user B deletes project "Test 3"
        And user A clicks on the "Export Project" option for that project
        Then the "Export Project" dialog opens
        When the user clicks on the "Export" button
        Then the dialog closes
        And there is an error message "Failed to export project"

Feature: import a project
    Scenario: imports via the browser
        Given there is a project with the name "Test 3" that has been exported and downloaded
        And the user does not see "Test 4" in the projects list
        When the user enters a new project name "Test 4"
        Then the Import via browser" and "Import form server" buttons are enabled
        When the user clicks on "Import via browser" 
        Then the browser file selector appears
        When the user chooses the export of the "Test 3" project
        Then the overlay and spinner appears
        And the message changes to "Import Complete"
        And the overlay is removed
        And the view switched to the default project view
        And the project scenarion on the shelf is named "Test 4"
        When the user switches back to the management view
        Then there is a project called "Test 4" in the project list
        
     Scenario: imports via the browser for insight 4
        Given the insight version is 4
        And there is a project with the name "Test 3" that has been exported
        And the user does not see "Test 4" in the projects list
        When the user enters a new project name "Test 4"
        Then the Import via browser" button are enabled
        When the user clicks on "Import via browser" 
        Then the browser file selector appears
        When the user chooses the export of the "Test 3" project
        Then the overlay and spinner appears
        And the message changes to "Import Complete"
        And the overlay is removed
        And the view switched to the default project view
        And the project scenarion on the shelf is named "Test 4"
        When the user switches back to the management view
        Then there is a project called "Test 4" in the project list
        
    Scenario: fails because the import file type is wrong
        Given there is a scenario with the name "my scenario that has been exported and downloaded
        And the user does not see "Test 4" in the projects list
        When the user enters a new project name "Test 4"
        Then the Import via browser" and "Import form server" buttons are enabled
        When the user clicks on "Import via browser" 
        Then the browser file selector appears
        When the user chooses the export of the "my scenario" scenario
        Then the overlay and spinner appears
        And the overlay is removed
        And there is an error toast saying that the import did not contain a project scenario
        And the projects list does not include the "Test 4 project
        
     Scenario: imports via the server
        Given there is a project with the name "Test 3" that has been exported
        And the user does not see "Test 4" in the projects list
        When the user enters a new project name "Test 4"
        Then the Import via browser" and "Import form server" buttons are enabled
        When the user clicks on "Import via server" 
        Then the Folder/Scenario Import dialog appears
        When the user chooses the export of the "Test 3" project
        Then the import task appeared in the Tasks dialog
        And the overlay and spinner appears
        And the message changes to "Import Complete"
        And the task completed
        And the overlay is removed
        And the view switched to the default project view
        And the project scenarion on the shelf is named "Test 4"
        When the user switches back to the management view
        Then there is a project called "Test 4" in the project list

Feature: project/scenario consistency check
    Scenario: when the user modifies the project, the scenarios are flagged as out of date wrt. to the project config
        Given the user has opened a project and been navigated to the data view
        And the user creates a scenario
        And the user adds the scenario to the shelf
        And the user loads and runs the scenario successfully
        When the user edits the number of accounts and reloads the project scenario
        And the user navigates to the scenario setup view
        Then the user sees an info message saying the scenario is out of date
        
    Scenario: a user can rerun the scenario to bring it up to date wrt. to the project config
        Given the user an open project
        And the user has a scenario which is out of date wrt. the project config.
        And the user is on the scenario setup view
        And the user sees the info message saying the scenario is out of date
        When the user reruns the scenario
        Then the info message is no longer displayed.
      
        